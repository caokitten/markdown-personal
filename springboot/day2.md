### 关于员工管理模块的知识点

- @Options

  - 用于为一条 sql 映射语句提供额外的, 更详细的配置选项

  - useGeneratedKeys = true
  
    启用“获取自增组件”:
  
    ```java
    /*
        当设置为 true 时，MyBatis 在执行 SQL 时会通过 JDBC 驱动告诉数据库：“我需要返回生成的主键”。这通常对应于 JDBC 的 PreparedStatement.executeUpdate(String sql, int autoGeneratedKeys) 方法，并传入 Statement.RETURN_GENERATED_KEYS 标志
    */
    ```
  
  - keyProperty = "id"
  
    指定返回的主键值赋给某个对象的某条属性
  
    ```java
    /*
    工作流程:
    <1 Mapper方法调用
    <2 MyBatis执行sql语句,数据库生成一个新的主键值
    <3 useGeneratedKeys = true ,MyBatis通过JDBC驱动获取到该主键值
    <4 keyProperty = "id" ,MyBatis调用传入对象的setId()方法,将新主键值赋予该对象
    */
    ```
    
  - 在 xml 文件中, 这些属性可直接添加在 sql 标签内(xml 不允许使用注解, 注解是 java 的语法)
  
- <foreach>

  用于迭代一个集合, 动态生成 sql: [详解](ai/foreach.md)
  
  ```xml
  <?xml version="1.0" encoding="UTF-8" ?>
  <!DOCTYPE mapper
          PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
          "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.itheima.mapper.EmpExprMapper">
  
      <!--批量插入员工工作经历信息-->
      <insert id="insertBatch">
          insert into emp_expr (emp_id, begin, end, company, job) values
          <!-- Error详见下 -->
          <foreach collection="exprList" item="expr" separator=",">
              (#{expr.empId}, #{expr.begin}, #{expr.end}, #{expr.company}, #{expr.job})
          </foreach>
      </insert>
  
  </mapper>
  ```
  
  - 这里用到 Mybatis 中的动态 SQL 里提供的 `<foreach>` 标签，改标签的作用，是用来遍历循环，常见的属性说明：
  
    1. collection：集合名称
    2. item：集合遍历出来的元素/项
    3. separator：每一次遍历使用的分隔符
    4. open：遍历开始前拼接的片段
    5. close：遍历结束后拼接的片段
  
    上述的属性，是可选的，并不是所有的都是必须的。 可以自己根据实际需求，来指定对应的属性。
  
  - Error: org.apache.ibatis.binding.BindingException: Parameter ‘customerIdList’ not found. Available parameters are [collection, list]
  
    `当我们传递一个List实例或者数组作为参数对象传给MyBatis。当你这么做的时候,MyBatis会自动将它包装在一个Map中,用名称在作为键。List实例将会以“list”作为键,而数组实例将会以“array”作为键。所以，当我们传递的是一个List集合时，mybatis会自动把我们的list集合包装成以list为Key值的map,MyBatis会将collection的值与该Map的键值进行匹配,因其不一致MyBatis找不到collection对应的键值而引发该错误`
    
    [collection 的工作原理](ai\collection.md)
    
    ```xml
    <!-- 解决方案 -->
    
    <!-- 1.collection强制指定为list -->
    <!-- 当参数只有一个时,collection的值可以设置为'list'或'collection' -->
    <foreach collection="list" item="expr" separator=",">
                (#{expr.empId}, #{expr.begin}, #{expr.end}, #{expr.company}, #{expr.job})
            </foreach>
    
    <!-- 2.使用参数注解@Param -->
    <!-- 参数注解使得MyBatis在包装Map时将其键值命名为指定名 -->
    void insertBatch(@Param("exprList") List<EmpExpr> exprList);
        
    <!-- 3.手动将参数包装为一个Map -->
        
    void insertBatch(Map exprList);
        
    empExprMapper.insertBatch(new Map().put("exprList",exprList));
    ```
    
    

